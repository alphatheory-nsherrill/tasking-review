# IN-3581 - TimesSquare Bloomberg Enrichment File

**Type:** Bug | **Feature** | Exploration | Other  
**Est:** 5h | **Confidence:** 90%

## Problem & Goal
*What needs to be done and why?*

TimesSquare has a file from Bloomberg's RMS that they would like to integrate as a research upload. Has all 3 scenarios,
their anaylst names, and all of their checklist items. For the price targets, there are Bull, Base, and Bear, each 
with 3 columns apiece for Price Target, Probability, and Rationale.

Basically, this file has columns for Bloomberg Ticker and Currency Code. There is also a column for Analyst Name, but
all parties want that changed to Analyst Email. There is also a custom field "% Wgt" that we should also map.

Then, there are three scenarios: Bull, Base, Bear. Each of those scenarios has a Target Price, a Probability, and a Rationale.

Finally, there are a few columns that map to "checklist items" with the following mappings

BALANCE SHEET FLEXIBILITY  
Healthy Flexibility == "H" for database value  
Medium Flexibility == "M" for database value  
Little Flexibility == "L" for database value  

BEATING NUMBERS  
Beating by 2% == "B" for database value  
Inline == "I" for database value  
Missing by 2% == "M" for database value  

BUSINESS QUALITY  
Best == "T" for database value  
Better == "B" for database value  
Good == "G" for database value

MACRO SENSITIVITY  
Insensitive == "I" for database value  
Average Sensitivity == "A" for database value  
High Sensitivity == "H" for database value  

Price Momentum  
3% Alpha == "A" for database value  
Neutral == "N" for database value  
-3% Alpha == "B" for database value  


## Deliverables
*What gets produced? (Code changes, document, analysis, etc.)*

New adapter that reads in the file, matches assets to ones in the main TimesSquare portfolio, and adds the custom fields
and scenarios.

## Entry Points
*Where to start? Key files/docs/concepts to understand first*

Start with the given enrichment file, and review how enhancement files are created, with explicit department matching.

## Plan
*High-level approach - bullet points preferred*

The only potential snag in this file is that the assets in the file seem to be grouped by the portfolio. There are
header rows that show the source file name, and I presume the rows that come after are from that source file. John Ryan
has indicated that this will probably not be a problem.

Other than that, the adapter should be straightforward. This is an enhancement adapter, and we already have examples of
enhancement adapters that should only be mapping rows that are already in the main department.

---

## Execution Notes
*Fill as you work - blockers, discoveries, pivots*

There was a lot more to this adapter, because of the development that there were multiple fund mappings. The holistic
department matching strategy would probably not have been viable, because the system would have to perform the matching
logic for each of the fund mappings.

Another complication with the matching was that the Bloomberg Tickers provided were not in the normalized composite BBG
pattern. This could lead to misses. 

To solve this, we implemented a First-In-First-Out matching system for matching an asset on multiple funds within the same
department. We added a field to the fund mapping definition that sets the preferred fund ID, which we try to match on
first. After that, we translate the BBG Ticker on an asset to the normalized composite ticker, and match from there. 

Once we have matched the ticker in one fund, we have the ticker ID on the state bean, and don't need to match again, so
we set a flag to skip over the function the following times.

The rest of the adapter is straightforward, using the scenario definitions I learned how to create earlier this week.

### Themes

This comes back to the theme of data completeness from our providers. We were told up front that we could not get SEDOL
or CUSIP on the file, so we had to make do with what we had, ramping up the complexity.

## Time Spent
**Actual:** 10h (Research: 2.5h | Implementation: 7.5h)

## Retrospective
**What went differently than planned?**

The complexity of the issue revealed itself with the answer to each question. What was being asked was not impossible,
but it definitely was not apparent up front.

**Key learnings or gotchas:**

This issue gave insight into the composite bloomberg ticker system, and what we have to support it at this time. This
reveals the pitfalls of just using bloomberg ticker as the identifier, and how it does not lead to 100% accurate data.